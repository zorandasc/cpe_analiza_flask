<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />

    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='reports/report.css') }}"
    />

    <!-- FOR WEASYPRINT WeasyPrint does not understand Flask routing: url_for.
    It only understands file paths. -->
    <link rel="stylesheet" href="static/reports/report.css" />
    <style>
      @page {
        @top-center {
          content: "Sedmični izvještaj CPE opreme — Sedmica {{ week }}";
        }
      }
    </style>
  </head>

  <body>
    <section class="page cover">
      <div class="cover-header">
        <h1>Sedmični Izvještaj CPE Inventara</h1>
        <h2>Za sedmicu {{ week }}</h2>
      </div>

      <div class="cover-divider"></div>

      <div class="cover-meta">
        <p><strong>Generisano:</strong> {{ today.strftime("%d.%m.%Y") }}</p>
        <p><strong>Sistem:</strong> Upravljanje i Analiza CPE Inventara</p>
        <p><strong>Odjeljenje:</strong> Planiranje CPE opreme</p>
      </div>

      <div class="cover-footer">
        <p>Samo za internu upotrebu</p>
      </div>
    </section>

    <div class="page-break"></div>

    <section class="page summary">
      <h1>Sažetak sedmice</h1>

      <table class="summary-table">
        <thead>
          <tr>
            <th>CPE oprema ukupna skladišta i IJ</th>
            <th>Prošla sedmica</th>
            <th>Ova sedmica</th>
            <th>Promjena</th>
          </tr>
        </thead>
        <tbody>
        {% for label, vals in summary.cpetotal.items() %}
          <tr>
            <td>{{label}}</td>
            <td>{{ vals.previous }}</td>
            <td>{{ vals.current }}</td>
            <td class="{{ 'pos' if vals.difference > 0 else 'neg' }}">
              {{ vals.difference }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <table class="summary-table">
        <thead>
          <tr>
            <th>CPE u raspoloživa oprema</th>
            <th>Prošla sedmica</th>
            <th>Ova sedmica</th>
            <th>Promjena</th>
          </tr>
        </thead>
        <tbody>
        {% for label, vals in summary.cpewarehouse.items() %}
          <tr>
            <td>{{label}}</td>
            <td>{{ vals.previous }}</td>
            <td>{{ vals.current }}</td>
            <td class="{{ 'pos' if vals.difference > 0 else 'neg' }}">
              {{ vals.difference }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <table class="summary-table">
        <thead>
          <tr>
            <th>CPE demontirana oprema IJ</th>
            <th>Prošla sedmica</th>
            <th>Ova sedmica</th>
            <th>Promjena</th>
          </tr>
        </thead>
        <tbody>
        {% for label, vals in summary.cpedismantle.items() %}
          <tr>
            <td>{{label}}</td>
            <td>{{ vals.previous }}</td>
            <td>{{ vals.current }}</td>
            <td class="{{ 'pos' if vals.difference > 0 else 'neg' }}">
              {{ vals.difference }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <table class="summary-table">
        <thead>
          <tr>
            <th>IPTV platforma</th>
            <th>Prošla sedmica</th>
            <th>Ova sedmica</th>
            <th>Promjena</th>
          </tr>
        </thead>
        <tbody>
         {% for label, vals in summary.stb.items() %}
          <tr>
            <td>{{label}}</td>
            <td>{{ vals.previous }}</td>
            <td>{{ vals.current }}</td>
            <td class="{{ 'pos' if vals.difference > 0 else 'neg' }}">
              {{ vals.difference }}
            </td>
          </tr>
           {% endfor %}
           {% for label, vals in summary.iptv.items() %}
            <tr>
                <td>{{label}}</td>
                <td>{{ vals.previous }}</td>
                <td>{{ vals.current }}</td>
                <td class="{{ 'pos' if vals.difference > 0 else 'neg' }}">
                  {{ vals.difference }}
                </td>
              </tr>
           {% endfor %}
        </tbody>
      </table>

      <table class="summary-table">
        <thead>
          <tr>
            <th>GPON pristupna mreža</th>
            <th>Prošli mijesec</th>
            <th>Ovaj mijesec</th>
            <th>Promjena</th>
          </tr>
        </thead>
        <tbody>
        {% for label, vals in summary.ont.items() %}
             <tr>
                <td>{{label}}</td>
                <td>{{ vals.previous }}</td>
                <td>{{ vals.current }}</td>
                <td class="{{ 'pos' if vals.difference > 0 else 'neg' }}">
                  {{ vals.difference }}
                </td>
              </tr>
           {% endfor %}
        </tbody>
      </table>
      <!--
      <h2>Značajne promjene (promjena veća od 1000 jedinica)</h2>
      {% for source, changes in significant_changes.items() %}
      <div class="change-group">
        <h3>{{ source }}</h3>

        <ul class="changes">
          {% for c in changes %}
          <li class="{{ 'up' if c.diff > 0 else 'down' }}">
            {{ c.equipment }}
            <span class="diff">
              {% if c.diff > 0 %} +{{ c.diff }} {% else %} {{ c.diff }} {% endif
              %}
            </span>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endfor %}
      -->
    </section>

    <div class="page-break"></div>

    <section class="page charts">
      <h1>Trendovi u inventaru</h1>
      <img src="{{ cpe_chart_image }}" alt="CPE Trend Chart" />
      <img
        src="{{ cpe_dismantle_chart_image }}"
        alt="CPE Dismantle Trend Chart"
      />
      <img src="{{ stb_chart_image }}" alt="STB Trend Chart" />
      <img src="{{ iptv_chart_image }}" alt="IPTV Trend Chart" />
      <img src="{{ ont_chart_image }}" alt="ONT Trend Chart" />
    </section>
  </body>
</html>
