<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}CPE-ANALIZA{% endblock %}</title>

    <!-- Local Bootstrap -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='bootstrap.min.css') }}"
    />
    <script src="{{ url_for('static', filename='bootstrap.bundle.min.js') }}"></script>

    <script src="{{ url_for('static', filename='vendor/chartjs/chart.umd.min.js') }}"></script>

    {% block styles %}
    <style>
      html {
        scroll-behavior: smooth;
        /* Add this: prevents content from jumping when the navbar shrinks */
        scroll-padding-top: 80px;
      }
      body {
  background-color: #f8f9fa; /* Light Bootstrap gray */
  background-image: radial-gradient(circle at top right, #f0eded 0%, #e0e2e3 100%);
  min-height: 100vh;
}

.container {
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.05);
  margin-top: 20px;
}

      body {
        /* This ensures even pages with 1 row of data have enough 
     "room" to scroll past the 50px trigger point without looping */
        min-height: 101vh;
      }

      /* --- Navbar Base --- */
      .navbar-custom {
        background-color: rgba(255, 255, 255, 1);
        padding: 0.75rem 1rem;
        transition: all 0.3s ease-in-out; /* Smooth transition for everything */
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08) !important;
      }

      .navbar-sticky {
        position: sticky;
        top: 0;
        z-index: 1030;
        border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        transition:
          padding 0.3s ease,
          background-color 0.3s ease,
          box-shadow 0.3s ease;
      }

      /* --- Scrolled State (The "Contracted" Navbar) --- */
      .navbar-sticky.scrolled {
        padding-top: 0.2rem;
        padding-bottom: 0.4rem;
        background-color: rgba(255, 255, 255, 0.95) !important;
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5) !important;
      }

      /* Shrink Logo on scroll */
      .navbar-sticky.scrolled .logo img {
        height: 35px;
      }

      /* --- Links & Branding --- */
      .navbar-custom .navbar-brand,
      .navbar-custom .nav-link {
        color: #212529;
        font-weight: 500;
        transition: all 0.2s ease;
      }

      .navbar-custom .nav-link:hover {
        color: #0d6efd;
      }

      .navbar-custom .nav-link.active {
        color: #212529 !important;
        border-bottom: 3px solid transparent;
        border-image: linear-gradient(to right, #be93c5, #7bc6cc);
        border-image-slice: 1;
        padding-bottom: 0.1rem;
      }

      .logo {
        margin-right: 2rem;
        margin-left: 0.75rem;
      }

      .navbar-username {
        background: linear-gradient(to right, #be93c5, #7bc6cc);
        color: #121212;
        padding: 4px 12px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.9rem;
        margin: 0 0.5rem;
      }
    </style>
    {% endblock %}
  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom navbar-sticky">
      <div class="container-fluid">
        <a class="navbar-brand logo" href="{{ url_for('main.home') }}">
          <img
            src="{{ url_for('static', filename='logo.png') }}"
            alt="CPE-ANALIZA Logo"
            height="50"
            class="d-inline-block align-text-top"
          />
        </a>

        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarContent"
          aria-controls="navbarContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
          <!-- LEFT -->
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == url_for('main.home') %}active{% endif %}"
                href="{{ url_for('main.home') }}"
                aria-current="page"
              >
                Poƒçetna
              </a>
            </li>
            {% if current_user.is_authenticated %}
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == url_for('cpe_inventory.cpe_records') %}active{% endif %}"
                href="{{ url_for('cpe_inventory.cpe_records') }}"
                aria-current="page"
              >
                CPE oprema
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == url_for('cpe_dismantle_inventory.cpe_dismantle_records') %}active{% endif %}"
                href="{{ url_for('cpe_dismantle_inventory.cpe_dismantle_records') }}"
                aria-current="page"
              >
                Demontirana CPE oprema
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == url_for('stb_inventory.stb_records') %}active{% endif %}"
                href="{{ url_for('stb_inventory.stb_records') }}"
                aria-current="page"
              >
                STB oprema
              </a>
            </li>
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == url_for('ont_inventory.ont_records') %}active{% endif %}"
                href="{{ url_for('ont_inventory.ont_records') }}"
                aria-current="page"
              >
                ONT oprema
              </a>
            </li>
              <li class="nav-item">
              <a
                class="nav-link {% if request.path == url_for('charts.chart_home') %}active{% endif %}"
                href="{{ url_for('charts.chart_home') }}"
                aria-current="page"
              >
                Analitika i Trendovi
              </a>
            </li>
            {% endif %}
          </ul>

          <!-- RIGHT -->
          {% if current_user.is_authenticated %}
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item">
              <a
                class="nav-link {% if request.path == url_for('admin.dashboard') %}active{% endif %}"
                href="{{ url_for('admin.dashboard') }}"
              >
                Admin Panel
              </a>
            </li>
            <li class="nav-item">
              <span class="nav-link navbar-username">
                üë§ {{ current_user.username }}
              </span>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('auth.logout') }}">Logout</a>
            </li>
          </ul>
          {% endif %}
        </div>
      </div>
    </nav>

    <!-- MAIN PAGE CONTENT -->
    <div class="container mt-4">{% block content %}{% endblock %}</div>

    <!-- Toast Container -->
    <div
      aria-live="polite"
      aria-atomic="true"
      class="position-fixed top-0 end-0 mt-5 p-3"
      style="z-index: 9999"
    >
      <div id="toast-container"></div>
    </div>

    <!-- Toast Template (hidden) -->
    <div
      id="toast-template"
      class="toast align-items-center text-bg-primary border-0"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
      style="display: none"
    >
      <div class="d-flex">
        <div class="toast-body"></div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
        ></button>
      </div>
    </div>

    <script>
      const nav = document.querySelector(".navbar-sticky");
      let lastScrollY = window.scrollY;

      window.addEventListener(
        "scroll",
        () => {
          const currentScrollY = window.scrollY;

          // SCROLL DOWN: Shrink at 50px
          if (currentScrollY > 50) {
            if (!nav.classList.contains("scrolled")) {
              nav.classList.add("scrolled");
            }
          }
          // SCROLL UP: Only expand when very close to the top (e.g., < 10px)
          // This gap between 10 and 50 prevents the flickering "loop"
          else if (currentScrollY <= 10) {
            if (nav.classList.contains("scrolled")) {
              nav.classList.remove("scrolled");
            }
          }

          lastScrollY = currentScrollY;
        },
        { passive: true },
      );
    </script>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Jinja renders this as a valid JS array ‚Äî VS Code is happy ‚úî
        const flashMessages = JSON.parse(
          `{{ get_flashed_messages(with_categories=True) | tojson | safe }}`,
        );

        const container = document.getElementById("toast-container");
        const template = document.getElementById("toast-template");

        flashMessages.forEach(([category, message]) => {
          const toastEl = template.cloneNode(true);
          toastEl.id = "";
          toastEl.style.display = "block";
          toastEl.querySelector(".toast-body").innerText = message;

          // category-based styling
          toastEl.classList.remove("text-bg-primary");
          if (category === "success") toastEl.classList.add("text-bg-success");
          if (category === "danger") toastEl.classList.add("text-bg-danger");
          if (category === "warning") toastEl.classList.add("text-bg-warning");
          if (category === "info") toastEl.classList.add("text-bg-info");

          container.appendChild(toastEl);
          new bootstrap.Toast(toastEl, { delay: 4000 }).show();
        });
      });
    </script>
  </body>
</html>
