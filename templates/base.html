<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{% block title %}CPE-ANALIZA{% endblock %}</title>

    <!-- Local Bootstrap -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='bootstrap.min.css') }}"
    />
    <script src="{{ url_for('static', filename='bootstrap.bundle.min.js') }}"></script>

    {% block styles %}
    <style>
      .navbar-custom {
        background-color: transparent;
        padding: 0.75rem 1rem;
      }

      .navbar-custom .navbar-brand,
      .navbar-custom .nav-link {
        color: #212529;
        font-weight: 500;
        transition: color 0.2s ease, border-color 0.2s ease;
      }

      /* =========================
   Hover state
========================= */
      .navbar-custom .nav-link:hover {
        color: #0d6efd;
      }

      /* =========================
   Active link
========================= */
      .navbar-custom .nav-link.active {
        color: #212529 !important;
        border-bottom: 3px solid transparent;
        border-image: linear-gradient(to right, #be93c5, #7bc6cc);
        border-image-slice: 1;
        padding-bottom: 0.4rem;
      }

      /* =========================
   Logo spacing
========================= */
      .logo {
        margin-right: 2rem;
        margin-left: 0.75rem;
      }

      /* =========================
   Username badge
========================= */
      .navbar-username {
        background: linear-gradient(to right, #be93c5, #7bc6cc);
        color: #121212;
        padding: 4px 12px;
        border-radius: 999px;
        font-weight: 600;
        font-size: 0.9rem;
        margin-right: 0.5rem;
      }

      /* =========================
   Logout link subtle
========================= */
      .navbar-custom .nav-link[href*="logout"] {
        color: #6c757d;
      }

      .navbar-custom .nav-link[href*="logout"]:hover {
        color: #dc3545;
      }

      .navbar-sticky {
  position: sticky;
  top: 0;
  z-index: 1030; /* above content, below modals */
  backdrop-filter: blur(3px);
  -webkit-backdrop-filter: blur(3px);
  background-color: rgba(255, 255, 255, 0.75);
  border-bottom: 1px solid rgba(0, 0, 0, 0.06);
}

/* Smooth appearance */
.navbar-sticky {
  transition: background-color 0.2s ease, box-shadow 0.2s ease;
}

/* Slight shadow when scrolling (optional) */
body:not(:has(.navbar:hover)) .navbar-sticky {
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}
    </style>
    {% endblock %}
  </head>
  <body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-custom navbar-sticky">
  <div class="container-fluid">
    <a class="navbar-brand logo" href="{{ url_for('home') }}">
      <img
        src="{{ url_for('static', filename='logo.png') }}"
        alt="CPE-ANALIZA Logo"
        height="50"
        class="d-inline-block align-text-top"
      />
    </a>

    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarContent"
      aria-controls="navbarContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarContent">
      <!-- LEFT -->
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item">
          <a
            class="nav-link {% if request.path == url_for('home') %}active{% endif %}"
            href="{{ url_for('home') }}"
            aria-current="page"
          >
            Poƒçetna
          </a>
        </li>

        {% if current_user.is_authenticated %}
        <li class="nav-item">
          <a
            class="nav-link {% if request.path == url_for('admin_dashboard') %}active{% endif %}"
            href="{{ url_for('admin_dashboard') }}"
          >
            Admin Panel
          </a>
        </li>
        {% endif %}
      </ul>

      <!-- RIGHT -->
      {% if current_user.is_authenticated %}
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item">
          <span class="nav-link navbar-username">
            üë§ {{ current_user.username }}
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
        </li>
      </ul>
      {% endif %}
    </div>
  </div>
</nav>

    <!-- MAIN PAGE CONTENT -->
    <div class="container mt-4">{% block content %}{% endblock %}</div>

    <!-- Toast Container -->
    <div
      aria-live="polite"
      aria-atomic="true"
      class="position-fixed top-0 end-0 mt-5 p-3"
      style="z-index: 9999"
    >
      <div id="toast-container"></div>
    </div>

    <!-- Toast Template (hidden) -->
    <div
      id="toast-template"
      class="toast align-items-center text-bg-primary border-0"
      role="alert"
      aria-live="assertive"
      aria-atomic="true"
      style="display: none"
    >
      <div class="d-flex">
        <div class="toast-body"></div>
        <button
          type="button"
          class="btn-close btn-close-white me-2 m-auto"
          data-bs-dismiss="toast"
        ></button>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Jinja renders this as a valid JS array ‚Äî VS Code is happy ‚úî
        const flashMessages = JSON.parse(
          `{{ get_flashed_messages(with_categories=True) | tojson | safe }}`
        );

        const container = document.getElementById("toast-container");
        const template = document.getElementById("toast-template");

        flashMessages.forEach(([category, message]) => {
          const toastEl = template.cloneNode(true);
          toastEl.id = "";
          toastEl.style.display = "block";
          toastEl.querySelector(".toast-body").innerText = message;

          // category-based styling
          toastEl.classList.remove("text-bg-primary");
          if (category === "success") toastEl.classList.add("text-bg-success");
          if (category === "danger") toastEl.classList.add("text-bg-danger");
          if (category === "warning") toastEl.classList.add("text-bg-warning");
          if (category === "info") toastEl.classList.add("text-bg-info");

          container.appendChild(toastEl);
          new bootstrap.Toast(toastEl, { delay: 4000 }).show();
        });
      });
    </script>
  </body>
</html>
